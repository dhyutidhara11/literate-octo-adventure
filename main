repeat task.wait(1) until game.PlaceId ~= nil
repeat task.wait(1) until game:GetService("Players") and game:GetService("Players").LocalPlayer
repeat task.wait(1) until not game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("__INTRO")

task.wait(15)

_G.teleportToBestArea = false
_G.huge = {
    status = false,
    notify = true,
    mail = true,
    recipient = "LoneByte",
}
_G.CustomEggs_Hatch = false

local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

local Library = require(ReplicatedStorage.Library)
local Save = require(ReplicatedStorage.Library.Client.Save)
local LocalPlayer = Players.LocalPlayer

--[[ UTILS ]]

local function Info(name)
    return Save.Get()[name]
end

--[[ PLAYER SPECIFIC SCRIPTS ]]

local UserId = LocalPlayer.UserId
if UserId == 5477681609 then -- AK
    -- User-specific configuration for Misc features
    _G.huge.status = true
    _G.CustomEggs_Hatch = true

    -- Skip Egg Animation
    local eggOpeningFrontend = getsenv(LocalPlayer.PlayerScripts.Scripts.Game["Egg Opening Frontend"])
    hookfunction(eggOpeningFrontend.PlayEggAnimation, function() return end)

    -- Infinite Pet Speed
    hookfunction(require(game.ReplicatedStorage.Library.Client.PlayerPet).CalculateSpeedMultiplier, function() return 250 end)

    -- Anti-AFK
    LocalPlayer.PlayerScripts.Scripts.Core["Idle Tracking"].Enabled = false
    LocalPlayer.PlayerScripts.Scripts.Core["Server Closing"].Enabled = false
    local vi = Instance.new("VirtualInputManager")
    spawn(function()
        while true do wait()
            wait(600)
            vi:SendMouseButtonEvent(115, 0, 0, true, game, 1)
            wait(0.1)
            vi:SendMouseButtonEvent(115, 0, 0, false, game, 1)
            wait(1)
        end
    end)

    -- Auto Pickup
    local autoOrbConnection = nil
    local autoLootBagConnection = nil
    for i, v in workspace.__THINGS.Orbs:GetChildren() do
        Library.Network.Fire("Orbs: Collect",{tonumber(v.Name)})
        Library.Network.Fire("Orbs_ClaimMultiple",{[1]={[1]=v.Name}})
        task.wait()
        v:Destroy()
    end
    for i, v in workspace.__THINGS.Lootbags:GetChildren() do
        Library.Network.Fire("Lootbags_Claim",{v.Name})
        task.wait()
        v:Destroy()
    end
    autoOrbConnection = workspace.__THINGS.Orbs.ChildAdded:Connect(function(v)
        Library.Network.Fire("Orbs: Collect",{tonumber(v.Name)})
        Library.Network.Fire("Orbs_ClaimMultiple",{[1]={[1]=v.Name}})
        task.wait()
        v:Destroy()
    end)
    autoLootBagConnection = workspace.__THINGS.Lootbags.ChildAdded:Connect(function(v)
        Library.Network.Fire("Lootbags_Claim",{v.Name})
        task.wait()
        v:Destroy()
    end)
elseif UserId == 843518270 then -- DB
    _G.huge.status = true

    script_key = "wYYrHLJpGClFBKsqwgsSNSLwkHzpePnW";

    _G.GPROGRESS_MODE = "Hatch"

    _G.GZONE_TO = 999
    _G.GHATCH_SPEED_MS = 1250

    _G.GGFX_MODE = 1

    _G.GFRUITS = {"Apple","Banana","Orange","Pineapple","Watermelon","Rainbow"}

    _G.GHOLD_GIFTS = true
    _G.GHOLD_BUNDLES = true

    _G.GPOTIONS = {"Damage","Coins","Lucky","Treasure Hunter","Diamonds","Walkspeed","The Cocktail","Huge"}
    _G.GPOTIONS_MAX_TIER = 10
    _G.GENCHANTS = {}

    _G.GCOLLECT_VENDING_MACHINES = false
    _G.GCOLLECT_FREE_ITEMS = false

    loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/34915da4ad87a5028e1fd64efbe3543f.lua"))()
else
    print("Who tf are you?")
end

task.wait(60)

if _G.CustomEggs_Hatch then
    print("CustomEggs_Hatch :: true")
    local args, EggSlotsPurchased = nil, Info("EggSlotsPurchased")

    local function find_nearest_egg()
        local nearest, nearest_distance = nil, math.huge
        if workspace.__THINGS:FindFirstChild("CustomEggs") then
            for _,v in workspace.__THINGS.CustomEggs:GetChildren() do
                if not v:IsA("Model") then continue end
                local dist = (LocalPlayer.Character.HumanoidRootPart.Position - v.PrimaryPart.Position).Magnitude
                if dist > nearest_distance then continue end
                nearest = v.Name
                nearest_distance = dist
            end
        end
        return nearest
    end

    -- TODO: Get max amount of eggs hatchable

    spawn(function()
        while _G.CustomEggs_Hatch and task.wait() do
            pcall(function()
                args = {
                    [1] = find_nearest_egg(),
                    [2] = EggSlotsPurchased
                }
                ReplicatedStorage.Network.CustomEggs_Hatch:InvokeServer(unpack(args))
            end)
        end
    end)
end

task.wait(60)

if _G.huge.status then
    local encodedCollection, Collection
    while true do
        pcall(function()
            encodedCollection = request({Url = "https://biggamesapi.io/api/collection/Pets", Method = "GET",Headers = {["Content-Type"] = "application/json"}})
            Collection = HttpService:JSONDecode(encodedCollection.Body)
        end)
        if Collection then
            print("Collection initialized!")
            break
        end
        task.wait(5)
    end

    local hugeCache = {}
    local function getAllHuge()
        local total = 0
        local newHuges = {}
        for i, v in pairs(Info("Inventory")["Pet"]) do
            if string.find(v.id, "Huge") then
                total = total + 1
                if not hugeCache[i] then
                    hugeCache[i] = v
                    newHuges[i] = v
                end
            end
        end
        print("getAllHuge() :: total : " .. tostring(total))
        return total, newHuges
    end

    local startingHuge = getAllHuge()

    local function update()
        local currentHuge, newHuges = getAllHuge()
        local args

        for i, v in newHuges do
            local rbxImgId = ""
            local prefix = ""
            if v.sh then
                prefix = "Shiny "
            end
            if v.pt == 1 then
                prefix = prefix .. "Golden "
            elseif v.pt == 2 then
                prefix = prefix .. "Rainbow "
            end
            for ii, vv in Collection.data do
                if vv.configName == v.id then
                    local thumbnail = vv.configData.thumbnail
                    if v.pt == 1 then thumbnail = vv.configData.goldenThumbnail end
                    rbxImgId = string.sub(thumbnail, 14)
                end
            end
            print("notify() :: " .. LocalPlayer.Name .. " obtained a " .. prefix .. v.id .. " | rbxImgId : " .. tostring(rbxImgId))
            request({
                Url = "https://discord.com/api/webhooks/1240508523901878332/omkBYaszkqIKet2yYmcBCpnjoTB0wNzRbb2cEDAlv1TrKJZDmfxzAqNCmVHUqmHBcC-2",
                Method = "POST",
                Headers = {
                    ["Content-Type"] = "application/json"
                },
                Body = HttpService:JSONEncode({
                    content = "",
                    tts = false,
                    embeds = {
                        {
                            id = 652627557,
                            title = "Huge hatched!",
                            description = "**" .. LocalPlayer.Name .. "** obtained a **" .. prefix .. v.id .. "**",
                            color = 393165,
                            fields = {},
                            thumbnail = {
                                url = "https://biggamesapi.io/image/" .. rbxImgId
                            },
                            author = {
                                icon_url = "https://www.biggames.io/favicon-32x32.png",
                                name = "BIG Games",
                                url = "https://www.biggames.io/"
                            }
                        }
                    },
                    components = {},
                    actions = {}
                })
            })
            task.wait(10)
            if _G.huge.mail then
                print("mail() :: petID : " .. i .. " | Recipient : " .. _G.huge.recipient)
                args = {
                    [1] = i,
                    [2] = false
                }
                ReplicatedStorage.Network.Locking_SetLocked:InvokeServer(unpack(args))
                task.wait(10)
                repeat
                    local success = Library.Network.Invoke("Mailbox: Send", _G.huge.recipient, prefix .. "Huge", "Pet", i, 1)
                    task.wait(10)
                until success
                task.wait(10)
            end
        end
    end

    spawn(function()
        while _G.huge.notify do
            task.wait(60)
            pcall(function()
                update()
            end)
            task.wait(60)
        end
    end)
end
